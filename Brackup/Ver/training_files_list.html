{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block content %}
<div id="content-main">
    
    <div class="results">
        <table id="result_list">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Tamanho</th>
                    <th>Data de Criação</th>
                    <th>Propósito</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td>{{ file.id }}</td>
                    <td>{{ file.filename }}</td>
                    <td>{{ file.bytes|filesizeformat }}</td>
                    <td>{{ file.created_at|date:"d/m/Y H:i" }}</td>
                    <td>{{ file.purpose }}</td>
                    <td>
                        <button class="deleteBtn" data-file-id="{{ file.id }}"
                                onclick="deleteFile('{{ file.id }}')">
                            Excluir
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="6">Nenhum arquivo encontrado.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function deleteFile(fileId) {
    if (!confirm('Tem certeza que deseja excluir este arquivo?')) return;
    
    fetch(`./delete/${fileId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.error || 'Erro ao excluir arquivo');
        }
    })
    .catch(error => {
        alert('Erro ao excluir arquivo');
        console.error('Erro:', error);
    });
}
</script>
{% endblock %}
